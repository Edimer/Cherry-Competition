full_data %>%
mutate(bloom_date = as.Date(bloom_date)) %>%
group_by(bloom_date) %>%
summarise(mean_bloom = mean(bloom_day, na.rm = TRUE))
full_data %>%
mutate(bloom_date = as.Date(bloom_date)) %>%
group_by(bloom_date)
full_data %>%
mutate(bloom_date = as.Date(bloom_date)) %>%
group_by(bloom_date) %>%
summarise(mean_bloom = mean(bloom_day, na.rm = TRUE))
full_data %>%
mutate(bloom_date = as.Date(bloom_date)) %>%
group_by(bloom_date) %>%
summarise(mean_bloom = mean(bloom_doy, na.rm = TRUE))
full_data %>%
mutate(bloom_date = as.Date(bloom_date)) %>%
group_by(bloom_date, new_location) %>%
summarise(mean_bloom = mean(bloom_doy, na.rm = TRUE))
full_data %>%
mutate(bloom_date = as.Date(bloom_date)) %>%
group_by(bloom_date, new_location) %>%
summarise(mean_bloom = mean(bloom_doy, na.rm = TRUE),
median_bloom = median(bloom_doy, na.rm = TRUE))
full_data %>%
mutate(bloom_date = as.Date(bloom_date)) %>%
group_by(bloom_date, new_location) %>%
summarise(mean_bloom = mean(bloom_doy, na.rm = TRUE),
median_bloom = median(bloom_doy, na.rm = TRUE)) %>%
ungroup()
full_data %>%
mutate(bloom_date = as.Date(bloom_date),
month = month(bloom_date)) %>%
count(month, new_location) %>%
group_by(month) %>%
mutate(total_month = sum(n)) %>%
ungroup() %>%
mutate(proportion = n / total_month) %>%
ggplot(aes(
x = month,
y = proportion,
fill = new_location,
color = new_location
)) +
geom_col(alpha = 0.7) +
coord_flip() +
scale_x_continuous(breaks = seq(1, 12, 1))
full_data %>%
mutate(bloom_date = as.Date(bloom_date),
month = month(bloom_date)) %>%
count(month, new_location) %>%
group_by(month) %>%
mutate(total_month = sum(n)) %>%
ggplot(aes(
x = month,
y = total_month,
fill = new_location,
color = new_location
)) +
facet_wrap( ~ new_location, scales = "free") +
geom_col(alpha = 0.7, show.legend = FALSE) +
scale_x_continuous(breaks = seq(1, 12, 1))
full_data %>%
mutate(bloom_date = as.Date(bloom_date)) %>%
group_by(bloom_date, new_location) %>%
summarise(
mean_bloom = mean(bloom_doy, na.rm = TRUE),
median_bloom = median(bloom_doy, na.rm = TRUE)
) %>%
ungroup()
full_data %>%
mutate(bloom_date = as.Date(bloom_date)) %>%
group_by(bloom_date, new_location) %>%
summarise(
mean_bloom = mean(bloom_doy, na.rm = TRUE),
median_bloom = median(bloom_doy, na.rm = TRUE),
sd_bloom = sd(bloom_doy, na.rm = TRUE)
) %>%
ungroup()
full_data %>%
mutate(bloom_date = as.Date(bloom_date)) %>%
group_by(bloom_date, new_location) %>%
summarise(
mean_bloom = mean(bloom_doy, na.rm = TRUE),
median_bloom = median(bloom_doy, na.rm = TRUE)
) %>%
ungroup()
full_data %>%
mutate(bloom_date = as.Date(bloom_date)) %>%
group_by(bloom_date, new_location) %>%
summarise(
mean_bloom = mean(bloom_doy, na.rm = TRUE),
median_bloom = median(bloom_doy, na.rm = TRUE)
) %>%
ungroup() %>%
pivot_longer(cols = -c(bloom_date, new_location))
full_data %>%
mutate(bloom_date = as.Date(bloom_date)) %>%
group_by(bloom_date, new_location) %>%
summarise(
mean_bloom = mean(bloom_doy, na.rm = TRUE),
median_bloom = median(bloom_doy, na.rm = TRUE)
) %>%
ungroup() %>%
pivot_longer(cols = -c(bloom_date, new_location),
names_to = "metric")
full_data %>%
mutate(bloom_date = as.Date(bloom_date)) %>%
group_by(bloom_date, new_location) %>%
summarise(
mean_bloom = mean(bloom_doy, na.rm = TRUE),
median_bloom = median(bloom_doy, na.rm = TRUE)
) %>%
ungroup() %>%
pivot_longer(cols = -c(bloom_date, new_location))
full_data %>%
mutate(bloom_date = as.Date(bloom_date)) %>%
group_by(bloom_date, new_location) %>%
summarise(
mean_bloom = mean(bloom_doy, na.rm = TRUE),
median_bloom = median(bloom_doy, na.rm = TRUE)
) %>%
ungroup() %>%
pivot_longer(cols = -c(bloom_date, new_location)) %>%
ggplot(aes(x = bloom_date, y = value, color = name)) +
facet_wrap(~new_location, scales = "free")
full_data %>%
mutate(bloom_date = as.Date(bloom_date)) %>%
group_by(bloom_date, new_location) %>%
summarise(
mean_bloom = mean(bloom_doy, na.rm = TRUE),
median_bloom = median(bloom_doy, na.rm = TRUE)
) %>%
ungroup() %>%
pivot_longer(cols = -c(bloom_date, new_location)) %>%
ggplot(aes(x = bloom_date, y = value, color = name)) +
facet_wrap(~new_location, scales = "free") +
geom_line()
full_data %>%
mutate(bloom_date = as.Date(bloom_date)) %>%
group_by(bloom_date, new_location) %>%
summarise(
mean_bloom = mean(bloom_doy, na.rm = TRUE),
median_bloom = median(bloom_doy, na.rm = TRUE)
) %>%
ungroup() %>%
pivot_longer(cols = -c(bloom_date, new_location)) %>%
ggplot(aes(x = bloom_date, y = value, color = name)) +
facet_wrap(~new_location, scales = "free") +
geom_line(alpha = 0.5)
full_data %>%
mutate(bloom_date = as.Date(bloom_date)) %>%
group_by(bloom_date, new_location) %>%
summarise(
mean_bloom = mean(bloom_doy, na.rm = TRUE),
median_bloom = median(bloom_doy, na.rm = TRUE)
) %>%
ungroup() %>%
pivot_longer(cols = -c(bloom_date, new_location)) %>%
ggplot(aes(x = bloom_date, y = value, color = name)) +
facet_wrap(~new_location, scales = "free") +
geom_line(alpha = 0.5) +
geom_smooth()
full_data %>%
mutate(bloom_date = as.Date(bloom_date)) %>%
group_by(bloom_date, new_location) %>%
summarise(
median_bloom = median(bloom_doy, na.rm = TRUE)
) %>%
ungroup() %>%
ggplot(aes(x = bloom_date, y = median_bloom, color = name)) +
facet_wrap(~new_location, scales = "free") +
geom_line(alpha = 0.5) +
geom_smooth()
full_data %>%
mutate(bloom_date = as.Date(bloom_date)) %>%
group_by(bloom_date, new_location) %>%
summarise(
median_bloom = median(bloom_doy, na.rm = TRUE)
) %>%
ungroup()
full_data %>%
mutate(bloom_date = as.Date(bloom_date)) %>%
group_by(bloom_date, new_location) %>%
summarise(
median_bloom = median(bloom_doy, na.rm = TRUE)
) %>%
ungroup() %>%
ggplot(aes(x = bloom_date, y = median_bloom, color = name))
full_data %>%
mutate(bloom_date = as.Date(bloom_date)) %>%
group_by(bloom_date, new_location) %>%
summarise(
median_bloom = median(bloom_doy, na.rm = TRUE)
) %>%
ungroup() %>%
ggplot(aes(x = bloom_date, y = median_bloom)) +
facet_wrap(~new_location, scales = "free") +
geom_line(alpha = 0.5) +
geom_smooth()
full_data %>%
mutate(bloom_date = as.Date(bloom_date)) %>%
group_by(bloom_date, new_location) %>%
summarise(median_bloom = median(bloom_doy, na.rm = TRUE)) %>%
ungroup() %>%
ggplot(aes(x = bloom_date, y = median_bloom)) +
facet_wrap(~ new_location, scales = "free") +
geom_line(alpha = 0.5) +
geom_smooth()
suppressMessages(
full_data %>%
mutate(bloom_date = as.Date(bloom_date)) %>%
group_by(bloom_date, new_location) %>%
summarise(median_bloom = median(bloom_doy, na.rm = TRUE)) %>%
ungroup() %>%
ggplot(aes(x = bloom_date, y = median_bloom)) +
facet_wrap(~ new_location, scales = "free") +
geom_line(alpha = 0.5) +
geom_smooth()
)
full_data %>%
mutate(bloom_date = as.Date(bloom_date)) %>%
group_by(bloom_date, new_location) %>%
summarise(median_bloom = median(bloom_doy, na.rm = TRUE)) %>%
ungroup() %>%
ggplot(aes(x = bloom_date, y = median_bloom)) +
facet_wrap(~ new_location, scales = "free") +
geom_line(alpha = 0.5) +
geom_smooth()
suppressWarnings(
full_data %>%
mutate(bloom_date = as.Date(bloom_date)) %>%
group_by(bloom_date, new_location) %>%
summarise(median_bloom = median(bloom_doy, na.rm = TRUE)) %>%
ungroup() %>%
ggplot(aes(x = bloom_date, y = median_bloom)) +
facet_wrap(~ new_location, scales = "free") +
geom_line(alpha = 0.5) +
geom_smooth()
)
suppressWarnings(
suppressMessages(
full_data %>%
mutate(bloom_date = as.Date(bloom_date)) %>%
group_by(bloom_date, new_location) %>%
summarise(median_bloom = median(bloom_doy, na.rm = TRUE)) %>%
ungroup() %>%
ggplot(aes(x = bloom_date, y = median_bloom)) +
facet_wrap(~ new_location, scales = "free") +
geom_line(alpha = 0.5) +
geom_smooth()
)
)
full_data %>%
mutate(bloom_date = as.Date(bloom_date)) %>%
group_by(bloom_date, new_location) %>%
summarise(median_bloom = median(bloom_doy, na.rm = TRUE)) %>%
ungroup() %>%
ggplot(aes(x = bloom_date, y = median_bloom)) +
facet_wrap(~ new_location, scales = "free") +
geom_line(alpha = 0.5) +
geom_smooth()
full_data %>%
mutate(bloom_date = as.Date(bloom_date))
full_data %>%
mutate(bloom_date = as.Date(bloom_date)) %>%
filter(bloom_date >= "1900-01-01")
full_data %>%
mutate(bloom_date = as.Date(bloom_date))
full_data %>%
mutate(bloom_date = as.Date(bloom_date)) %>%
filter(bloom_date >= "1900-01-01") %>%
group_by(bloom_date, new_location) %>%
summarise(median_bloom = median(bloom_doy, na.rm = TRUE)) %>%
ungroup() %>%
ggplot(aes(x = bloom_date, y = median_bloom)) +
facet_wrap(~ new_location, scales = "free") +
geom_line(alpha = 0.5) +
geom_smooth()
full_data %>%
mutate(bloom_date = as.Date(bloom_date)) %>%
filter(bloom_date >= "1900-01-01") %>%
group_by(bloom_date, new_location) %>%
summarise(median_bloom = median(bloom_doy, na.rm = TRUE)) %>%
ungroup() %>%
ggplot(aes(x = bloom_date, y = median_bloom)) +
facet_wrap(~ new_location, scales = "free") +
geom_line(alpha = 0.5) +
geom_smooth()
full_data %>%
ggplot(aes(x = new_location, y = bloom_doy, fill = new_location,
color = new_location)) +
geom_boxplot(alpha = 0.7, show.legend = FALSE)
full_data %>%
ggplot(aes(
x = new_location,
y = bloom_doy,
fill = new_location,
color = new_location
)) +
geom_boxplot(alpha = 0.7, show.legend = FALSE)
full_data %>%
ggplot(aes(
x = new_location,
y = bloom_doy,
fill = new_location,
color = new_location
)) +
geom_boxplot(alpha = 0.5, show.legend = FALSE)
full_data
full_data %>%
select(new_location, lat, long, bloom_doy)
full_data %>%
select(new_location, lat, long, bloom_doy) %>%
pivot_longer(cols = c(lat, long))
full_data %>%
select(new_location, lat, long, bloom_doy) %>%
pivot_longer(cols = c(lat, long)) %>%
ggplot(aes(x = value, y = bloom_doy)) +
facet_wrap(~new_location, scales = "free")
full_data %>%
select(new_location, lat, long, bloom_doy) %>%
pivot_longer(cols = c(lat, long)) %>%
ggplot(aes(x = value, y = bloom_doy)) +
facet_wrap(~new_location, scales = "free") +
geom_point()
full_data %>%
select(new_location, lat, long, bloom_doy) %>%
pivot_longer(cols = c(lat, long)) %>%
ggplot(aes(x = value, y = bloom_doy)) +
facet_grid(~new_location~name, scales = "free") +
geom_point()
full_data %>%
select(new_location, lat, long, bloom_doy) %>%
pivot_longer(cols = c(lat, long)) %>%
ggplot(aes(x = value, y = bloom_doy)) +
facet_wrap(~new_location~name, scales = "free") +
geom_point()
full_data %>%
select(new_location, lat, long, bloom_doy) %>%
pivot_longer(cols = c(lat, long)) %>%
ggplot(aes(x = value, y = bloom_doy)) +
facet_wrap(~new_location~name, scales = "free") +
geom_point(alpha = 0.3)
full_data %>%
select(new_location, lat, long, bloom_doy) %>%
pivot_longer(cols = c(lat, long)) %>%
ggplot(aes(x = value, y = bloom_doy)) +
facet_wrap(~new_location~name, scales = "free") +
geom_point(alpha = 0.3)
full_data %>%
select(new_location, lat, long, bloom_doy) %>%
pivot_longer(cols = c(lat, long)) %>%
ggplot(aes(x = value, y = bloom_doy)) +
facet_wrap(~new_location~name, scales = "free") +
geom_point(alpha = 0.01)
full_data %>%
select(new_location, lat, long, bloom_doy) %>%
pivot_longer(cols = c(lat, long)) %>%
ggplot(aes(x = value, y = bloom_doy)) +
facet_wrap(~new_location~name, scales = "free") +
geom_point(alpha = 0.01) +
geom_smooth()
full_data %>%
select(new_location, lat, long, bloom_doy) %>%
pivot_longer(cols = c(lat, long)) %>%
ggplot(aes(x = value, y = bloom_doy)) +
facet_wrap(~new_location~name, scales = "free") +
geom_point(alpha = 0.05) +
geom_smooth()
library(tidyverse)
library(lubridate)
library(patchwork)
library(raster)
library(sf)
library(rgdal)
library(gdalUtils)
# Theme for ggplot2
theme_set(theme_minimal())
# Initial data
data_kyoto <- read_csv("../data/raw/kyoto.csv") %>%
mutate(new_location = "Kyoto")
data_liestal <- read_csv("../data/raw/liestal.csv")%>%
mutate(new_location = "Liestal")
data_wdc <- read_csv("../data/raw/washingtondc.csv")%>%
mutate(new_location = "Washington")
# Others
data_japan <- read_csv("../data/raw/japan.csv")%>%
mutate(new_location = "Japan")
data_metwiss <- read_csv("../data/raw/meteoswiss.csv")%>%
mutate(new_location = "MeteoSwiss")
data_skorea <- read_csv("../data/raw/south_korea.csv")%>%
mutate(new_location = "South Korea")
# Join
full_data <-
bind_rows(data_kyoto,
data_liestal,
data_wdc,
data_japan,
data_metwiss,
data_skorea)
write_csv(full_data, file =  "../data/processed/full_data_initial.csv")
full_data <- read_csv("../data/processed/full_data_initial.csv")
bioclim_data <- getData("worldclim", var = "bio", res = 2.5,
path = "../data/processed/")
cherry_sf <- full_data %>%
st_as_sf(coords = c(3, 2),
crs = "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0")
cherry_bioclim <- extract(bioclim_data, cherry_sf) %>%
as_tibble() %>%
bind_cols(full_data, .)
# Soil components
bulk_density <- "/vsicurl/https://files.isric.org/soilgrids/latest/data/bdod/bdod_15-30cm_mean.vrt"
caption_exchange <- "/vsicurl/https://files.isric.org/soilgrids/latest/data/cec/cec_15-30cm_mean.vrt"
vol_coarse <- "/vsicurl/https://files.isric.org/soilgrids/latest/data/cfvo/cfvo_15-30cm_mean.vrt"
clay <- "/vsicurl/https://files.isric.org/soilgrids/latest/data/clay/clay_15-30cm_mean.vrt"
nitro <- "/vsicurl/https://files.isric.org/soilgrids/latest/data/nitrogen/nitrogen_15-30cm_mean.vrt"
ph_soil <- "/vsicurl/https://files.isric.org/soilgrids/latest/data/phh2o/phh2o_15-30cm_mean.vrt"
sand <- "/vsicurl/https://files.isric.org/soilgrids/latest/data/sand/sand_15-30cm_mean.vrt"
silt <- "/vsicurl/https://files.isric.org/soilgrids/latest/data/silt/silt_15-30cm_mean.vrt"
soc <-"/vsicurl/https://files.isric.org/soilgrids/latest/data/soc/soc_15-30cm_mean.vrt"
ocd <- "/vsicurl/https://files.isric.org/soilgrids/latest/data/ocd/ocd_15-30cm_mean.vrt"
ocs <- "/vsicurl/https://files.isric.org/soilgrids/latest/data/ocs/ocs_0-30cm_mean.vrt"
list_soil <- list(bulk_density, caption_exchange, vol_coarse, clay, nitro,
ph_soil, sand, silt, soc, ocd, ocs)
source("../code-R/functions/limits_function.R")
source("../code-R/functions/names_tif.R")
source("../code-R/functions/generator_tif.R")
list_location <- cherry_sf %>%
pull(new_location) %>%
as_factor() %>%
levels()
list_location <- cherry_sf %>%
pull(new_location) %>%
as_factor() %>%
levels()
list_location
list_location
# Data Kyoto
data_kyoto <- cherry_sf %>% filter(new_location == "Kyoto")
data_kyoto
data_kyoto <- cherry_sf %>% filter(new_location == "Kyoto")
list_soil %>%
map(.f = generator_tif,
data = data_kyoto,
location = "Kyoto")
# Soil components
bulk_density <- "/vsicurl/https://files.isric.org/soilgrids/latest/data/bdod/bdod_15-30cm_mean.vrt"
caption_exchange <- "/vsicurl/https://files.isric.org/soilgrids/latest/data/cec/cec_15-30cm_mean.vrt"
vol_coarse <- "/vsicurl/https://files.isric.org/soilgrids/latest/data/cfvo/cfvo_15-30cm_mean.vrt"
clay <- "/vsicurl/https://files.isric.org/soilgrids/latest/data/clay/clay_15-30cm_mean.vrt"
nitro <- "/vsicurl/https://files.isric.org/soilgrids/latest/data/nitrogen/nitrogen_15-30cm_mean.vrt"
ph_soil <- "/vsicurl/https://files.isric.org/soilgrids/latest/data/phh2o/phh2o_15-30cm_mean.vrt"
sand <- "/vsicurl/https://files.isric.org/soilgrids/latest/data/sand/sand_15-30cm_mean.vrt"
silt <- "/vsicurl/https://files.isric.org/soilgrids/latest/data/silt/silt_15-30cm_mean.vrt"
soc <-"/vsicurl/https://files.isric.org/soilgrids/latest/data/soc/soc_15-30cm_mean.vrt"
ocd <- "/vsicurl/https://files.isric.org/soilgrids/latest/data/ocd/ocd_15-30cm_mean.vrt"
ocs <- "/vsicurl/https://files.isric.org/soilgrids/latest/data/ocs/ocs_0-30cm_mean.vrt"
list_soil <- list(bulk_density, caption_exchange, vol_coarse, clay, nitro,
ph_soil, sand, silt, soc, ocd, ocs)
source("../code-R/functions/limits_function.R")
source("../code-R/functions/names_tif.R")
source("../code-R/functions/generator_tif.R")
source("../code-R/functions/all_tif.R")
list_location <- cherry_sf %>%
pull(new_location) %>%
as_factor() %>%
levels()
list_location
View(full_data)
cherry_sf %>%
filter(new_location == "Kyoto")
full_data %>%
filter(new_location == "Kyoto")
full_data %>%
filter(new_location == "Kyoto") %>%
pull(lat) %>%
sd()
full_data %>%
filter(new_location == "Kyoto") %>%
pull(long) %>%
sd()
full_data %>%
filter(new_location == "Washington") %>%
pull(long) %>%
sd()
full_data %>%
filter(new_location == "Washington") %>%
pull(lat) %>%
sd()
full_data %>%
filter(new_location == "Liestal") %>%
pull(lat) %>%
sd()
full_data %>%
filter(new_location == "Liestal") %>%
pull(long) %>%
sd()
full_data %>%
filter(new_location == "Liestal")
View(full_data)
bioclim_data
View(cherry_sf)
View(cherry_bioclim)
limits_function(data_sf = full_data)
limits_function(data_sf = cherry_sf)
nitro
list(1, 2, 3)
list(1, 2, 3) %>% slice(2)
list(1, 2, 3) %>% {.[2]}
list(1, 2, 3) %>% slice(2)
nitro
